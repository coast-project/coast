import SConsider
import os, socket, pdb, re
from stat import *

Import('*')

cport1=43041
cport2=43042
cport3=43043

hostonly, domain, fqdn = SConsider.getfqdn()

searchReplace = {
    "HOSTNAME": hostonly,
    "CPORT1": str(cport1),
    "CPORT2": str(cport2),
    "CPORT3": str(cport3),
}

def setUp(target, source, env):
    tdir = env['BASEOUTDIR'].Dir(env['RELTARGETDIR'])
    configdir = tdir.Dir('config')
#    env['ENV']['COAST_LOGONCERR'] = 2
#    env['ENV']['COAST_PATH'] = ':'.join(['config', '.'])

def tearDown(target, source, env):
    pass

buildSettings = {
    packagename : {
        'linkDependencies' : [
            'CoastEBCDIC',
            'CoastMTFoundation',
            'testfwFoundation',
        ],
        'sourceFiles'      : SConsider.listFiles(['*.cpp']),
        'targetType'       : 'ProgramTest',
        'copyFiles'        : [(SConsider.listFiles(['config/*.any']), S_IRUSR | S_IRGRP | S_IROTH, searchReplace)],
        'runConfig' : {
            'setUp'        : setUp,
            'tearDown'     : tearDown,
        },
    },
}

SConsider.createTargets(packagename, buildSettings)

#-----------------------------------------------------------------------------------------------------
# Copyright (c) 2005, Peter Sommerlad and IFS Institute for Software at HSR Rapperswil, Switzerland
# All rights reserved.
#
# This library/application is free software; you can redistribute and/or modify it under the terms of
# the license that is included with this library/application in the file license.txt.
#-----------------------------------------------------------------------------------------------------

{

	/Modules {
		CacheHandlerModule
		MappersModule
		DataAccessImplsModule
	}

	/Mappers {}
	/DataAccessImpls {}

	/LDAPPort		"389"
	/LDAPBind		"cn=admin,dc=sifsstud1,dc=hsr,dc=ch"
	/LDAPTimeout	10
	/LDAPConnectionTimeout 5

	/ConnectionTest
	{
		# Wrong server
		{
			/LDAPServer		"nonexisting.server.loc"
			/LDAPPort		%LDAPPort
			/LDAPTimeout		%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName		%LDAPBind
			/LDAPBindPW		%LDAPBindPW
			/Expected 		0
			/Error {
				/Msg 		"Binding request failed. [Server: 'nonexisting.server.loc', Port: '389']  (Authorized bind.)"
				/LdapCode	81
				/LdapMsg	"Can't contact LDAP server"
				/LdapConnectionParams {
					/Server "nonexisting.server.loc"
					/Port 389
					/Timeout 10
					/ConnectionTimeout 5
					/BindName "cn=admin,dc=sifsstud1,dc=hsr,dc=ch"
					/BindPW "ifaifaifa"
					/PooledConnections 0
					/RebindTimeout 0
					/TryAutoRebind		0
					/MaxConnections 2				}
				/MsgAsString "LdapDataAccess: [DataAccess_0] Msg [Binding request failed. [Server: 'nonexisting.server.loc', Port: '49999']  (Authorized bind.)] LdapCode [91] LdapMsg [Can't connect to the LDAP server] LdapConnectionParams [{/Server \"nonexisting.server.loc\"/Port 49999/Timeout 10/ConnectionTimeout 5/BindName \"cn=Directory Manager\"/BindPW \"WipedOut\"/PooledConnections 0/RebindTimeout 0/TryAutoRebind 0/MaxConnections 2}]"
			}
		}

# -----------------------------------------------------------------------------------
# kgu: Removed, because it seemed to produce different results on different machines
# (due to different ldaplib versions?)
# if re-enabling, don't forget to re-insert the config switches (see other tests)
# -----------------------------------------------------------------------------------
#		/WrongPort {
#			/LDAPServer		%LDAPServer
#			/LDAPPort		1234
#			/LDAPTimeout	%LDAPTimeout
#			/LDAPConnectionTimeout	%LDAPConnectionTimeout
#			/LDAPBindName	%LDAPBind
#			/LDAPBindPW		%LDAPBindPW
#			/Expected 	0
#			/Error {
#				/Msg		"Binding request failed. [Server: 'marvin.hsr.loc', Port: '1234']  (Authorized bind.)"
#				/Msg		"Binding request failed. [Server: 'vivian.hank.com', Port: '1234']  (Authorized bind.)"
#				/LdapCode	81
#				/LdapMsg	"Can't contact LDAP server"
#				/LdapConnectionParams {
#					/Server "marvin.hsr.loc"
#					/Server "vivian.hank.com"
#					/Port 1234
#					/Timeout 10
#					/ConnectionTimeout 5
#					/BindName "cn=Directory Manager"
#					/BindPW "ifaifaifa"
#					/BindPW "hankhank"
#				}
#			}
#		}

		# Anonymous bind
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout		%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName		""
			/LDAPBindPW		""
			/Expected 		1		# success, no error
		}

		# Wrong bind name
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout		%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName		"cn=WrongBindName,dc=sifsstud1,dc=hsr,dc=ch"
			/LDAPBindPW		%LDAPBindPW
			/Expected 		0
			/Error {
				/Msg "LDAP request failed."
				/LdapCode 49
				/LdapMsg "Invalid credentials"
				/LdapConnectionParams {
					/Port 389
					/Timeout 10
					/ConnectionTimeout 5
					/BindName "cn=WrongBindName,dc=sifsstud1,dc=hsr,dc=ch"
					/PooledConnections 0
					/RebindTimeout 0
					/TryAutoRebind		0
					/MaxConnections 2
				}
			}
		}

		# WrongBindPW
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout		%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName		%LDAPBind
			/LDAPBindPW		"SillyNonexistingBindPW"
			/Expected 		0
			/Error {
				/Msg "LDAP request failed."
				/LdapCode 49
				/LdapMsg "Invalid credentials"
				/LdapConnectionParams
				{
					/Port 389
					/Timeout 10
					/ConnectionTimeout 5
					/BindName "cn=admin,dc=sifsstud1,dc=hsr,dc=ch"
					/BindPW "SillyNonexistingBindPW"
					/PooledConnections 0
					/RebindTimeout 0
					/TryAutoRebind		0
					/MaxConnections 2
				}
			}
		}
		#	Pooled connect, first
		{
			/NumberOfConnects 1
			/LDAPServer		"marvin.hsr.loc"
			/LDAPPort		"49999"
			/LDAPBind		"cn=Directory Manager"
			/LDAPBindPW		"ifaifaifa"
			/LDAPTimeout	10
			/LDAPConnectionTimeout 5
			/LDAPMaxConnections	   2
			/ConnectIsOk	1
			/ConnectRet 	"eOk"
			/LDAPPooledConnections 1
			/LDAPTryAutoRebind			1
			/LDAPRebindTimeout 600
		}
		# Pooled connect, follow ups
		{
			/NumberOfConnects 10
			/LDAPServer		"marvin.hsr.loc"
			/LDAPPort		"49999"
			/LDAPBind		"cn=Directory Manager"
			/LDAPBindPW		"ifaifaifa"
			/LDAPTimeout	10
			/LDAPConnectionTimeout 5
			/ConnectIsOk	1
			/ConnectRet 	"eOk"
			/LDAPPooledConnections 1
			/LDAPMaxConnections	   2
			/LDAPTryAutoRebind			1
			/LDAPRebindTimeout 600
		}

		# Correct bind, not pooled
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout		%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName		%LDAPBind
			/LDAPBindPW		%LDAPBindPW
			/Expected 		1		# success, no error
		}
	}
}

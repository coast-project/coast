#-----------------------------------------------------------------------------------------------------
# Copyright (c) 2005, Peter Sommerlad and IFS Institute for Software at HSR Rapperswil, Switzerland
# All rights reserved.
#
# This library/application is free software; you can redistribute and/or modify it under the terms of
# the license that is included with this library/application in the file license.txt.
#-----------------------------------------------------------------------------------------------------

{

	/LDAPServer		"marvin.hsr.loc"
	/LDAPPort		"49999"
	/LDAPBind		"cn=Directory Manager"
	/LDAPBindPW		"ifaifaifa"
	/LDAPTimeout	10
	/LDAPConnectionTimeout 5

	/ConnectionTest
	{
		# Wrong server
		{
			/LDAPServer		"nonexisting.server.loc"
			/LDAPPort		%LDAPPort
			/LDAPTimeout	%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName	%LDAPBind
			/LDAPBindPW		%LDAPBindPW
			/LDAPPooledConnections 0
			/LDAPRebindTimeout 0
			/ConnectIsOk	0
			/ConnectRet 	"eBindNok"
			/Error
			{
				/Msg 		"Binding request failed. [Server: 'nonexisting.server.loc', Port: '49999']  (Authorized bind.)"
				/LdapCode	91
				/LdapMsg	"Can't connect to the LDAP server"
				/LdapConnectionParams
				{
					/Server "nonexisting.server.loc"
					/Port 49999
					/Timeout 10
					/ConnectionTimeout 5
					/BindName "cn=Directory Manager"
					/BindPW "ifaifaifa"
					/PooledConnections 0
					/RebindTimeout 0
				}
				/MsgAsString "LdapDataAccess: [DataAccess_0] Msg [Binding request failed. [Server: 'nonexisting.server.loc', Port: '49999']  (Authorized bind.)] LdapCode [91] LdapMsg [Can't connect to the LDAP server] LdapConnectionParams [{/Server \"nonexisting.server.loc\"/Port 49999/Timeout 10/ConnectionTimeout 5/BindName \"cn=Directory Manager\"/BindPW \"WipedOut\"/PooledConnections 0/RebindTimeout 0}]"
			}
		}

# -----------------------------------------------------------------------------------
# kgu: Removed, because it seemed to produce different results on different machines
# (due to different ldaplib versions?)
# if re-enabling, don't forget to re-insert the config switches (see other tests)
# -----------------------------------------------------------------------------------
#		/WrongPort {
#			/LDAPServer		%LDAPServer
#			/LDAPPort		1234
#			/LDAPTimeout	%LDAPTimeout
#			/LDAPConnectionTimeout	%LDAPConnectionTimeout
#			/LDAPBindName	%LDAPBind
#			/LDAPBindPW		%LDAPBindPW
#			/Expected 	0
#			/Error {
#				/Msg		"Binding request failed. [Server: 'marvin.hsr.loc', Port: '1234']  (Authorized bind.)"
#				/Msg		"Binding request failed. [Server: 'vivian.hank.com', Port: '1234']  (Authorized bind.)"
#				/LdapCode	81
#				/LdapMsg	"Can't contact LDAP server"
#				/LdapConnectionParams {
#					/Server "marvin.hsr.loc"
#					/Server "vivian.hank.com"
#					/Port 1234
#					/Timeout 10
#					/ConnectionTimeout 5
#					/BindName "cn=Directory Manager"
#					/BindPW "ifaifaifa"
#					/BindPW "hankhank"
#				}
#			}
#		}

		# Anonymous bind
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout	%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName	""
			/LDAPBindPW		""
			/ConnectIsOk	1
			/ConnectRet 	"eOk"
		}

		# Wrong bind name
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout	%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName	"cn=WrongBindName"
			/LDAPBindPW		%LDAPBindPW
			/LDAPPooledConnections 0
			/LDAPRebindTimeout 0
			/ConnectIsOk	0
			/ConnectRet 	"eBindNok"
			/Error
			{
				/Msg "LDAP request failed."
				/LdapCode 32
				/LdapMsg "No such object"
				/LdapConnectionParams
				{
					/Server "marvin.hsr.loc"
					/Port 49999
					/Timeout 10
					/ConnectionTimeout 5
					/BindName "cn=WrongBindName"
					/BindPW "ifaifaifa"
					/PooledConnections 0
					/RebindTimeout 0
				}
				/MsgAsString "LdapDataAccess: [DataAccess_2] Msg [LDAP request failed.] LdapCode [32] LdapMsg [No such object] LdapConnectionParams [{/Server \"surlej.hsr.ch\"/Port 49999/Timeout 10/ConnectionTimeout 5/BindName \"cn=WrongBindName\"/BindPW \"WipedOut\"/PooledConnections 0/RebindTimeout 0}]"
			}
		}

		# WrongBindPW
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout	%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName	%LDAPBind
			/LDAPBindPW		"SillyNonexistingBindPW"
			/LDAPPooledConnections 0
			/LDAPRebindTimeout 	   0
			/ConnectIsOk	0
			/ConnectRet 	"eBindNok"
			/Error
			{
				/Msg "LDAP request failed."
				/LdapCode 49
				/LdapMsg "Invalid credentials"
				/LdapConnectionParams
				{
					/Server "marvin.hsr.loc"
					/Port 49999
					/Timeout 10
					/ConnectionTimeout 5
					/BindName "cn=Directory Manager"
					/BindPW "SillyNonexistingBindPW"
					/PooledConnections 0
					/RebindTimeout 0
				}
				/MsgAsString "LdapDataAccess: [DataAccess_3] Msg [LDAP request failed.] LdapCode [49] LdapMsg [Invalid credentials] LdapConnectionParams [{/Server \"surlej.hsr.ch\"/Port 49999/Timeout 10/ConnectionTimeout 5/BindName \"cn=Directory Manager\"/BindPW \"WipedOut\"/PooledConnections 0/RebindTimeout 0}]"
			}
		}
		#	Pooled connect, first
		{
			/NumberOfConnects 1
			/LDAPServer		"marvin.hsr.loc"
			/LDAPPort		"49999"
			/LDAPBind		"cn=Directory Manager"
			/LDAPBindPW		"ifaifaifa"
			/LDAPTimeout	10
			/LDAPConnectionTimeout 5
			/ConnectIsOk	1
			/ConnectRet 	"eRebindOk"
			/LDAPPooledConnections 1
			/LDAPRebindTimeout 600
		}
		# Pooled connect, follow ups
		{
			/NumberOfConnects 10
			/LDAPServer		"marvin.hsr.loc"
			/LDAPPort		"49999"
			/LDAPBind		"cn=Directory Manager"
			/LDAPBindPW		"ifaifaifa"
			/LDAPTimeout	10
			/LDAPConnectionTimeout 5
			/ConnectIsOk	1
			/ConnectRet 	"eOk"
			/LDAPPooledConnections 1
			/LDAPRebindTimeout 600
		}

		# Correct bind, not pooled
		{
			/LDAPServer		%LDAPServer
			/LDAPPort		%LDAPPort
			/LDAPTimeout	%LDAPTimeout
			/LDAPConnectionTimeout	%LDAPConnectionTimeout
			/LDAPBindName	%LDAPBind
			/LDAPBindPW		%LDAPBindPW
			/ConnectIsOk	1
			/ConnectRet 	"eOk"
		}
	}
}

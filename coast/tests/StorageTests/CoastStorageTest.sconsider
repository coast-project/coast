import SConsider, os
from stat import *

Import('*')

old_trace_storage = None

def setUp(target, source, env):
    if os.environ.has_key('TRACE_STORAGE'):
        old_trace_storage = os.environ['TRACE_STORAGE']
    os.environ['TRACE_STORAGE'] = "1"

def tearDown(target, source, env):
    if not old_trace_storage is None:
        os.environ['TRACE_STORAGE'] = old_trace_storage

buildSettings = {
    packagename : {
        'includeSubdir'    : '',
        'linkDependencies' : ['CoastMTFoundation', 'loki.lokiObjects', 'testfwFoundation'],
        'sourceFiles'      : SConsider.listFiles( ['*.cpp'] ),
        'targetType'       : 'ProgramTest',
        'copyFiles'        : [(SConsider.findFiles(['config'], ['.any']), S_IRUSR | S_IRGRP | S_IROTH)],
        'public' : {
        },
        'runConfig'        : {
                              'setUp': setUp,
                              'tearDown': tearDown,
                             },
    }
}

SConsider.createTargets( packagename, buildSettings )

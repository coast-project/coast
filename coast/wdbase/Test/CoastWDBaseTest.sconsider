import os
import SConsider
from stat import *

Import('*')

def setUp( target, source, env ):
#    env['ENV']['COAST_TRACE_INITFINIS'] = '1'
    env['ENV']['COAST_LOGONCERR'] = '3'
    env['ENV']['COAST_USE_MMAP_STREAMS'] = '0'

def tearDown( target, source, env ):
    pass

buildSettings = {
    packagename : {
        'linkDependencies' : ['CoastWDBase', 'testfwWDBase'],
        'requires'         : [SConsider.generateFulltargetname(packagename, 'TestLib')],
        'sourceFiles'      : SConsider.listFiles( ['*.cpp'] ),
        'targetType'       : 'ProgramTest',
        'copyFiles'        : [( SConsider.listFiles(['config/*.any', 'config/*.txt']), S_IRUSR | S_IRGRP | S_IROTH ),
                              ( SConsider.listFiles(['TestDir1', 'TestDir2'], recursive=True), S_IRUSR | S_IRGRP | S_IROTH )],
        'runConfig'        : {
            'setUp'        : setUp,
            'tearDown'     : tearDown,
        },
    },
    'TestLib' : {
        'includeSubdir'    : 'TestLib',
        'linkDependencies' : ['CoastWDBase'],
        'sourceFiles'      : SConsider.listFiles( ['TestLib/*.cpp'] ),
        'targetType'       : 'LibraryShared',
    }
}

SConsider.createTargets( packagename, buildSettings )
